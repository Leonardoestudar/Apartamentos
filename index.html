<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Organizador de Apartamentos</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #e3e5e8; }
    h1 { text-align: center; margin-bottom: 20px; }
    .container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
    .card { background-color: #f9f9f9; padding: 15px; border-radius: 10px; width: 280px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; cursor: pointer; display: flex; flex-direction: column; }
    .card img { width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
    .icons { position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; }
    .icons span { font-size: 20px; }
    .favorito { color: #f4c542; }
    .visitado { color: #4caf50; }
    .stars { color: gold; cursor: pointer; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 10; }
    .modal-content { background: #fefefe; padding: 20px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 90%; overflow-y: auto; }
    input, select, textarea { width: 100%; margin: 5px 0; padding: 8px; }
    button { padding: 8px 12px; margin: 5px; cursor: pointer; }
    #exportImport { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; }
    .gallery { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .gallery img { width: 100px; height: 100px; object-fit: cover; border-radius: 5px; }
</style>
</head>
<body>

<h1>Organizador de Apartamentos</h1>

<div id="exportImport">
    <button onclick="exportData()">Exportar Backup</button>
    <button onclick="importData()">Importar Backup</button>
</div>

<div style="text-align:center; margin-bottom:15px;">
    <button onclick="openModal('add')">Adicionar Apartamento</button>
</div>

<div class="container" id="apartamentosContainer"></div>

<!-- Modal Cadastro/Editar -->
<div class="modal" id="modalCadastro">
    <div class="modal-content">
        <h2 id="modalTitle">Adicionar Apartamento</h2>
        <form id="formApartamento">
            <input type="text" id="nome" placeholder="Nome">
            <input type="text" id="endereco" placeholder="Endereço">
            <input type="number" id="quartos" placeholder="Quartos">
            <input type="number" id="banheiros" placeholder="Banheiros">
            <input type="number" id="aluguel" placeholder="Valor do Aluguel">
            <select id="condominioIncluso">
                <option value="Incluso">Condomínio incluso</option>
                <option value="Valor">Condomínio não incluso</option>
            </select>
            <input type="number" id="valorCondominio" placeholder="Valor do Condomínio" style="display:none;">
            <textarea id="obs" placeholder="Observações"></textarea>
            <input type="text" id="linkImagem" placeholder="Link da imagem (opcional)">
            <input type="file" id="uploadImagem" accept="image/*">
            <input type="hidden" id="aptoId">
            <div style="text-align:right; margin-top:10px;">
                <button type="button" onclick="saveApartamento()">Salvar</button>
                <button type="button" onclick="closeModal('modalCadastro')">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Detalhes -->
<div class="modal" id="modalDetalhes">
    <div class="modal-content">
        <h2 id="detalhesNome"></h2>
        <div class="icons" id="detalhesIcons"></div>
        <div id="detalhesGaleria" class="gallery"></div>
        <p><strong>Endereço:</strong> <span id="detalhesEndereco"></span></p>
        <p><strong>Quartos:</strong> <span id="detalhesQuartos"></span> | <strong>Banheiros:</strong> <span id="detalhesBanheiros"></span></p>
        <p><strong>Aluguel:</strong> R$ <span id="detalhesAluguel"></span> | <strong>Condomínio:</strong> <span id="detalhesCondominio"></span></p>
        <p><strong>Observações:</strong> <span id="detalhesObs"></span></p>
        <div style="text-align:center; margin-top:10px;" id="detalhesStars"></div>
        <div class="actions">
            <button onclick="toggleFavorito()">Favorito</button>
            <button onclick="toggleVisitado()">Visitado</button>
            <button onclick="openModal('edit')">Editar</button>
            <button onclick="deleteApartamento()">Excluir</button>
            <button onclick="closeModal('modalDetalhes')">Fechar</button>
        </div>
        <div style="margin-top:15px;">
            <h3>Adicionar imagens:</h3>
            <input type="file" id="uploadDetalhesImagem" accept="image/*" multiple>
            <input type="text" id="linkDetalhesImagem" placeholder="Link de imagem (opcional)">
            <button onclick="addDetalhesImagem()">Adicionar</button>
        </div>
    </div>
</div>

<script>
let apartamentos = JSON.parse(localStorage.getItem('apartamentos')) || [];
let currentApto = null;
let isEditing = false;

function save(){ localStorage.setItem('apartamentos', JSON.stringify(apartamentos)); }

function openModal(type, apto=null){
    if(type==='add'){
        isEditing=false;
        document.getElementById('modalTitle').innerText='Adicionar Apartamento';
        document.getElementById('formApartamento').reset();
        document.getElementById('valorCondominio').style.display='none';
    } else if(type==='edit' && apto){
        isEditing=true;
        document.getElementById('modalTitle').innerText='Editar Apartamento';
        document.getElementById('nome').value=apto.nome;
        document.getElementById('endereco').value=apto.endereco;
        document.getElementById('quartos').value=apto.quartos;
        document.getElementById('banheiros').value=apto.banheiros;
        document.getElementById('aluguel').value=apto.aluguel;
        document.getElementById('condominioIncluso').value=(apto.condominio==='Incluso'?'Incluso':'Valor');
        document.getElementById('valorCondominio').value=(apto.condominio==='Incluso'?'':apto.condominio);
        document.getElementById('obs').value=apto.obs;
        document.getElementById('linkImagem').value=apto.link;
        document.getElementById('aptoId').value=apto.id;
        if(document.getElementById('condominioIncluso').value==='Valor') document.getElementById('valorCondominio').style.display='block';
    }
    document.getElementById(type==='add'?'modalCadastro':'modalCadastro').style.display='flex';
}

function closeModal(modalId){ document.getElementById(modalId).style.display='none'; render(); }

document.getElementById('condominioIncluso').addEventListener('change', ()=>{
    if(document.getElementById('condominioIncluso').value==='Valor'){
        document.getElementById('valorCondominio').style.display='block';
    } else {
        document.getElementById('valorCondominio').style.display='none';
    }
});

function saveApartamento(){
    const id = isEditing?parseInt(document.getElementById('aptoId').value):Date.now();
    const imagemFile = document.getElementById('uploadImagem').files[0];

    if(imagemFile){
        const reader = new FileReader();
        reader.onload=()=>{ saveAptoData(id, reader.result); };
        reader.readAsDataURL(imagemFile);
    } else saveAptoData(id, document.getElementById('linkImagem').value);
}

function saveAptoData(id, imageSrc){
    const aptoData = {
        id,
        nome: document.getElementById('nome').value,
        endereco: document.getElementById('endereco').value,
        quartos: document.getElementById('quartos').value || '',
        banheiros: document.getElementById('banheiros').value || '',
        aluguel: document.getElementById('aluguel').value || '',
        condominio: document.getElementById('condominioIncluso').value==='Incluso'?'Incluso':document.getElementById('valorCondominio').value || '',
        obs: document.getElementById('obs').value || '',
        link: document.getElementById('linkImagem').value || '',
        image: imageSrc || '',
        imagens: [],
        visitado: false,
        favorito: false,
        estrela: 0
    };

    if(isEditing){
        const index = apartamentos.findIndex(a=>a.id===id);
        aptoData.visitado = apartamentos[index].visitado;
        aptoData.favorito = apartamentos[index].favorito;
        aptoData.estrela = apartamentos[index].estrela;
        aptoData.imagens = apartamentos[index].imagens;
        apartamentos[index]=aptoData;
    } else apartamentos.push(aptoData);

    save();
    closeModal('modalCadastro');
}

function render(){
    const container = document.getElementById('apartamentosContainer');
    container.innerHTML='';
    apartamentos.forEach(a=>{
        const card = document.createElement('div');
        card.className='card';
        card.onclick=()=>{ openDetalhes(a); };
        let imgHtml=a.image?`<img src='${a.image}' alt='Apartamento'>`:a.link?`<img src='${a.link}'>`:'<div style="height:180px;background:#ddd;border-radius:8px;margin-bottom:10px;"></div>';
        let icons=`<div class='icons'>${a.favorito?'<span class="favorito">⭐</span>':''}${a.visitado?'<span class="visitado">✅</span>':''}</div>`;
        let starsHtml='';
        for(let i=1;i<=5;i++) starsHtml+=`<span class='stars' onclick='event.stopPropagation(); setStar(${a.id},${i})'>${i<=a.estrela?'★':'☆'}</span>`;
        card.innerHTML=icons+imgHtml+`<h3>${a.nome || ''}</h3><p>${a.quartos} quartos / ${a.banheiros} banheiros</p><p>Aluguel: ${a.aluguel} | Condomínio: ${a.condominio}</p><p>${starsHtml}</p>`;
        container.appendChild(card);
    });
}

function setStar(id, star){
    const apt = apartamentos.find(a=>a.id===id);
    apt.estrela=star;
    save();
    render();
}

function openDetalhes(apto){
    currentApto=apto;
    document.getElementById('detalhesNome').innerText=apto.nome;
    document.getElementById('detalhesEndereco').innerText=apto.endereco;
    document.getElementById('detalhesQuartos').innerText=apto.quartos;
    document.getElementById('detalhesBanheiros').innerText=apto.banheiros;
    document.getElementById('detalhesAluguel').innerText=apto.aluguel;
    document.getElementById('detalhesCondominio').innerText=apto.condominio;
    document.getElementById('detalhesObs').innerText=apto.obs;
    renderDetalhesStars();
    renderDetalhesGaleria();
    document.getElementById('detalhesIcons').innerHTML=`${apto.favorito?'<span class="favorito">⭐</span>':''}${apto.visitado?'<span class="visitado">✅</span>':''}`;
    document.getElementById('modalDetalhes').style.display='flex';
}

function renderDetalhesStars(){
    let starsHtml='';
    for(let i=1;i<=5;i++) starsHtml+=`<span class='stars' onclick='setDetalhesStar(${i})'>${i<=currentApto.estrela?'★':'☆'}</span>`;
    document.getElementById('detalhesStars').innerHTML=starsHtml;
}

function setDetalhesStar(star){
    currentApto.estrela=star;
    save();
    renderDetalhesStars();
    render();
}

function toggleFavorito(){
    currentApto.favorito=!currentApto.favorito;
    save();
    render();
    document.getElementById('detalhesIcons').innerHTML=`${currentApto.favorito?'<span class="favorito">⭐</span>':''}${currentApto.visitado?'<span class="visitado">✅</span>':''}`;
}

function toggleVisitado(){
    currentApto.visitado=!currentApto.visitado;
    save();
    render();
    document.getElementById('detalhesIcons').innerHTML=`${currentApto.favorito?'<span class="favorito">⭐</span>':''}${currentApto.visitado?'<span class="visitado">✅</span>':''}`;
}

function openModal(type){
    openModal(type,currentApto);
}

function deleteApartamento(){
    if(confirm('Deseja realmente excluir este apartamento?')){
        apartamentos=apartamentos.filter(a=>a.id!==currentApto.id);
        save();
        closeModal('modalDetalhes');
        render();
    }
}

function renderDetalhesGaleria(){
    const gal = document.getElementById('detalhesGaleria');
    gal.innerHTML='';
    if(currentApto.imagens && currentApto.imagens.length){
        currentApto.imagens.forEach(img=>{ const i=document.createElement('img'); i.src=img; gal.appendChild(i); });
    } else if(currentApto.image) gal.innerHTML=`<img src='${currentApto.image}'>`;
    else if(currentApto.link) gal.innerHTML=`<img src='${currentApto.link}'>`;
    else gal.innerHTML='<p style="text-align:center;color:#777;">Nenhuma imagem disponível</p>';
}

function addDetalhesImagem(){
    if(!currentApto.imagens) currentApto.imagens=[];
    const arquivos=document.getElementById('uploadDetalhesImagem').files;
    const link=document.getElementById('linkDetalhesImagem').value;
    if(link){ currentApto.imagens.push(link); document.getElementById('linkDetalhesImagem').value=''; save(); renderDetalhesGaleria(); }
    if(arquivos.length){
        Array.from(arquivos).forEach(arq=>{
            const reader=new FileReader();
            reader.onload=()=>{ currentApto.imagens.push(reader.result); save(); renderDetalhesGaleria(); };
            reader.readAsDataURL(arq);
        });
        document.getElementById('uploadDetalhesImagem').value='';
    }
}

function exportData(){
    const dataStr=JSON.stringify(apartamentos);
    const blob=new Blob([dataStr],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='apartamentos_backup.json'; a.click(); URL.revokeObjectURL(url);
}

function importData(){
    const input=document.createElement('input'); input.type='file'; input.accept='.json'; input.onchange=e=>{
        const file=e.target.files[0
